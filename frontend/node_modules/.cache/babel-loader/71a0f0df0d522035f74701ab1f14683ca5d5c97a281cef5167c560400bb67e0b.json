{"ast":null,"code":"var _jsxFileName = \"E:\\\\Employee Timesheet chatbot\\\\frontend\\\\src\\\\components\\\\ChatPage\\\\ChatPage.jsx\",\n  _s = $RefreshSig$();\n// src/components/ChatPage/ChatPage.jsx\n\nimport React, { useState, useEffect, useRef, useCallback } from 'react';\nimport './ChatPage.css';\nimport ChatPageView from './ChatPageView';\nimport { v4 as uuidv4 } from 'uuid'; // MUST BE INSTALLED\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst API_BASE_URL = 'http://127.0.0.1:5000';\nconst ChatPage = ({\n  user,\n  sessionToken,\n  onSignOut\n}) => {\n  _s();\n  // --- NEW STATE for History and Current Chat ---\n  const [chatList, setChatList] = useState([]); // Stores [{ id, title }, ...]\n  const [currentChatId, setCurrentChatId] = useState(null); // The ID of the currently active chat\n\n  // --- Existing State ---\n  const [messages, setMessages] = useState([]);\n  const [input, setInput] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState('');\n  const chatEndRef = useRef(null);\n  const initialLoadRef = useRef(true); // Helper to track the very first load\n\n  // Scroll to the bottom of the chat area when messages change\n  useEffect(() => {\n    var _chatEndRef$current;\n    (_chatEndRef$current = chatEndRef.current) === null || _chatEndRef$current === void 0 ? void 0 : _chatEndRef$current.scrollIntoView({\n      behavior: \"smooth\"\n    });\n  }, [messages]);\n\n  // --- API Handlers ---\n\n  // 1. Fetch the list of past chats\n  const fetchChatList = useCallback(async () => {\n    try {\n      const response = await fetch(`${API_BASE_URL}/api/chats`, {\n        // NEW API ENDPOINT\n        headers: {\n          'Authorization': `Bearer ${sessionToken}`\n        }\n      });\n      if (response.status === 401) {\n        onSignOut();\n        return;\n      }\n      if (!response.ok) {\n        throw new Error(\"Failed to fetch chat list.\");\n      }\n      const data = await response.json();\n      setChatList(data.chats || []);\n\n      // On initial load, set the current chat ID\n      if (initialLoadRef.current) {\n        if (data.chats.length > 0) {\n          setCurrentChatId(data.chats[0].id); // Load the most recent chat\n        } else {\n          handleNewChat(); // Start a new one if the list is empty\n        }\n        initialLoadRef.current = false;\n      }\n    } catch (err) {\n      console.error(\"Error fetching chat list:\", err);\n      setError(\"Failed to load chat history.\");\n    }\n  }, [sessionToken, onSignOut]);\n\n  // 2. Fetch messages for a specific chat ID\n  const fetchMessages = useCallback(async chatId => {\n    if (!chatId) return;\n    setIsLoading(true);\n    setMessages([]); // Clear old messages immediately\n\n    try {\n      const response = await fetch(`${API_BASE_URL}/api/chats/${chatId}/messages`, {\n        // MODIFIED API ENDPOINT\n        headers: {\n          'Authorization': `Bearer ${sessionToken}`\n        }\n      });\n      if (response.status === 401) {\n        onSignOut();\n        return;\n      }\n      if (!response.ok) {\n        throw new Error(`Failed to fetch messages for chat ${chatId}.`);\n      }\n      const data = await response.json();\n      setMessages(data.messages || []);\n      setError('');\n    } catch (err) {\n      console.error(\"Error fetching messages:\", err);\n      setError(err.message);\n      setMessages([]);\n    } finally {\n      setIsLoading(false);\n    }\n  }, [sessionToken, onSignOut]);\n\n  // 3. Delete a chat\n  const handleDeleteChat = async chatIdToDelete => {\n    if (!window.confirm(\"Are you sure you want to delete this chat history?\")) return;\n    try {\n      const response = await fetch(`${API_BASE_URL}/api/chats/${chatIdToDelete}`, {\n        method: 'DELETE',\n        headers: {\n          'Authorization': `Bearer ${sessionToken}`\n        }\n      });\n      if (response.status === 401) {\n        onSignOut();\n        return;\n      }\n      if (!response.ok) {\n        throw new Error(\"Failed to delete chat.\");\n      }\n\n      // Update local state\n      setChatList(prev => prev.filter(chat => chat.id !== chatIdToDelete));\n\n      // If the deleted chat was the current one, start a new chat\n      if (chatIdToDelete === currentChatId) {\n        setCurrentChatId(null);\n        handleNewChat();\n      }\n    } catch (err) {\n      console.error(\"Error deleting chat:\", err);\n      setError(\"Failed to delete chat history.\");\n    }\n  };\n\n  // --- UI/STATE Handlers ---\n\n  // A. Starts a new chat session\n  const handleNewChat = () => {\n    const newId = uuidv4();\n    // Add a temporary entry to the list (backend will confirm title on first message)\n    setChatList(prev => [{\n      id: newId,\n      title: 'New Chat'\n    }, ...prev]);\n    setCurrentChatId(newId);\n    setMessages([]);\n    setError('');\n    setInput('');\n  };\n\n  // B. Logic to load chat list on mount\n  useEffect(() => {\n    if (sessionToken) {\n      fetchChatList();\n    }\n  }, [sessionToken, fetchChatList]);\n\n  // C. Logic to load messages when currentChatId changes\n  useEffect(() => {\n    if (currentChatId) {\n      fetchMessages(currentChatId);\n    }\n  }, [currentChatId, fetchMessages]);\n\n  // --- Core Chat Handlers (Modified to use currentChatId) ---\n\n  const handleSendMessage = async e => {\n    e.preventDefault();\n    const message = input.trim();\n    if (!message || isLoading || !currentChatId) return;\n    setIsLoading(true);\n    setInput('');\n    const userMessage = {\n      sender: 'user',\n      text: message,\n      timestamp: new Date().toISOString()\n    };\n    setMessages(prev => [...prev, userMessage]);\n    try {\n      var _chatList$find;\n      const response = await fetch(`${API_BASE_URL}/api/chat`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${sessionToken}`\n        },\n        body: JSON.stringify({\n          message,\n          chat_id: currentChatId\n        }) // SEND the unique chat_id\n      });\n      if (response.status === 401) {\n        onSignOut();\n        return;\n      }\n      const data = await response.json();\n      if (!response.ok) {\n        throw new Error(data.error || 'Chat response failed.');\n      }\n      const botMessage = {\n        sender: 'bot',\n        text: data.response,\n        timestamp: new Date().toISOString()\n      };\n      setMessages(prev => [...prev, botMessage]);\n\n      // If this was a new chat, update the title in the list\n      if (((_chatList$find = chatList.find(c => c.id === currentChatId)) === null || _chatList$find === void 0 ? void 0 : _chatList$find.title) === 'New Chat') {\n        setChatList(prev => prev.map(chat => chat.id === currentChatId ? {\n          ...chat,\n          title: data.chat_title || message.substring(0, 25)\n        } : chat));\n      }\n    } catch (err) {\n      console.error(err);\n      setError(err.message);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  // File upload must also be associated with the current chat ID\n  const handleFileUpload = async file => {\n    if (isLoading || !currentChatId) return;\n    setIsLoading(true);\n    setError('');\n    const formData = new FormData();\n    formData.append('file', file);\n    formData.append('chat_id', currentChatId); // SEND the unique chat_id\n\n    try {\n      const response = await fetch(`${API_BASE_URL}/upload`, {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${sessionToken}`\n        },\n        body: formData\n      });\n      if (response.status === 401) {\n        onSignOut();\n        return;\n      }\n      const data = await response.json();\n      if (!response.ok) {\n        throw new Error(data.error || 'File upload failed.');\n      }\n      const botMessage = {\n        sender: 'bot',\n        text: data.message,\n        timestamp: new Date().toISOString()\n      };\n      setMessages(prev => [...prev, botMessage]);\n    } catch (err) {\n      console.error(err);\n      setError(err.message);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  // Consolidate props for the view component\n  const viewProps = {\n    // State & Refs\n    user,\n    messages,\n    input,\n    setInput,\n    isLoading,\n    error,\n    chatEndRef,\n    onSignOut,\n    // Handlers\n    handleSendMessage,\n    handleFileUpload,\n    // NEW History Props\n    currentChatId,\n    chatList,\n    setCurrentChatId,\n    // This acts as onSelectChat\n    handleNewChat,\n    onDeleteChat: handleDeleteChat\n  };\n  return /*#__PURE__*/_jsxDEV(ChatPageView, {\n    ...viewProps\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 243,\n    columnNumber: 9\n  }, this);\n};\n_s(ChatPage, \"/JN6vsGB2F2XhGQX0rqub2HMXF8=\");\n_c = ChatPage;\nexport default ChatPage;\nvar _c;\n$RefreshReg$(_c, \"ChatPage\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useCallback","ChatPageView","v4","uuidv4","jsxDEV","_jsxDEV","API_BASE_URL","ChatPage","user","sessionToken","onSignOut","_s","chatList","setChatList","currentChatId","setCurrentChatId","messages","setMessages","input","setInput","isLoading","setIsLoading","error","setError","chatEndRef","initialLoadRef","_chatEndRef$current","current","scrollIntoView","behavior","fetchChatList","response","fetch","headers","status","ok","Error","data","json","chats","length","id","handleNewChat","err","console","fetchMessages","chatId","message","handleDeleteChat","chatIdToDelete","window","confirm","method","prev","filter","chat","newId","title","handleSendMessage","e","preventDefault","trim","userMessage","sender","text","timestamp","Date","toISOString","_chatList$find","body","JSON","stringify","chat_id","botMessage","find","c","map","chat_title","substring","handleFileUpload","file","formData","FormData","append","viewProps","onDeleteChat","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["E:/Employee Timesheet chatbot/frontend/src/components/ChatPage/ChatPage.jsx"],"sourcesContent":["// src/components/ChatPage/ChatPage.jsx\r\n\r\nimport React, { useState, useEffect, useRef, useCallback } from 'react';\r\nimport './ChatPage.css'; \r\nimport ChatPageView from './ChatPageView'; \r\nimport { v4 as uuidv4 } from 'uuid'; // MUST BE INSTALLED\r\n\r\nconst API_BASE_URL = 'http://127.0.0.1:5000';\r\n\r\nconst ChatPage = ({ user, sessionToken, onSignOut }) => {\r\n    // --- NEW STATE for History and Current Chat ---\r\n    const [chatList, setChatList] = useState([]); // Stores [{ id, title }, ...]\r\n    const [currentChatId, setCurrentChatId] = useState(null); // The ID of the currently active chat\r\n    \r\n    // --- Existing State ---\r\n    const [messages, setMessages] = useState([]);\r\n    const [input, setInput] = useState('');\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [error, setError] = useState('');\r\n    const chatEndRef = useRef(null);\r\n    const initialLoadRef = useRef(true); // Helper to track the very first load\r\n\r\n    // Scroll to the bottom of the chat area when messages change\r\n    useEffect(() => {\r\n        chatEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n    }, [messages]);\r\n\r\n    // --- API Handlers ---\r\n\r\n    // 1. Fetch the list of past chats\r\n    const fetchChatList = useCallback(async () => {\r\n        try {\r\n            const response = await fetch(`${API_BASE_URL}/api/chats`, { // NEW API ENDPOINT\r\n                headers: { 'Authorization': `Bearer ${sessionToken}` }\r\n            });\r\n            if (response.status === 401) { onSignOut(); return; }\r\n            if (!response.ok) { throw new Error(\"Failed to fetch chat list.\"); }\r\n            \r\n            const data = await response.json();\r\n            setChatList(data.chats || []);\r\n\r\n            // On initial load, set the current chat ID\r\n            if (initialLoadRef.current) {\r\n                if (data.chats.length > 0) {\r\n                    setCurrentChatId(data.chats[0].id); // Load the most recent chat\r\n                } else {\r\n                    handleNewChat(); // Start a new one if the list is empty\r\n                }\r\n                initialLoadRef.current = false;\r\n            }\r\n\r\n        } catch (err) {\r\n            console.error(\"Error fetching chat list:\", err);\r\n            setError(\"Failed to load chat history.\");\r\n        }\r\n    }, [sessionToken, onSignOut]);\r\n\r\n    // 2. Fetch messages for a specific chat ID\r\n    const fetchMessages = useCallback(async (chatId) => {\r\n        if (!chatId) return;\r\n        setIsLoading(true);\r\n        setMessages([]); // Clear old messages immediately\r\n\r\n        try {\r\n            const response = await fetch(`${API_BASE_URL}/api/chats/${chatId}/messages`, { // MODIFIED API ENDPOINT\r\n                headers: { 'Authorization': `Bearer ${sessionToken}` }\r\n            });\r\n\r\n            if (response.status === 401) { onSignOut(); return; }\r\n            if (!response.ok) { throw new Error(`Failed to fetch messages for chat ${chatId}.`); }\r\n\r\n            const data = await response.json();\r\n            setMessages(data.messages || []);\r\n            setError('');\r\n        } catch (err) {\r\n            console.error(\"Error fetching messages:\", err);\r\n            setError(err.message);\r\n            setMessages([]);\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    }, [sessionToken, onSignOut]);\r\n    \r\n    // 3. Delete a chat\r\n    const handleDeleteChat = async (chatIdToDelete) => {\r\n        if (!window.confirm(\"Are you sure you want to delete this chat history?\")) return;\r\n\r\n        try {\r\n            const response = await fetch(`${API_BASE_URL}/api/chats/${chatIdToDelete}`, {\r\n                method: 'DELETE',\r\n                headers: { 'Authorization': `Bearer ${sessionToken}` }\r\n            });\r\n\r\n            if (response.status === 401) { onSignOut(); return; }\r\n            if (!response.ok) { throw new Error(\"Failed to delete chat.\"); }\r\n\r\n            // Update local state\r\n            setChatList(prev => prev.filter(chat => chat.id !== chatIdToDelete));\r\n            \r\n            // If the deleted chat was the current one, start a new chat\r\n            if (chatIdToDelete === currentChatId) {\r\n                setCurrentChatId(null); \r\n                handleNewChat();\r\n            }\r\n\r\n        } catch (err) {\r\n            console.error(\"Error deleting chat:\", err);\r\n            setError(\"Failed to delete chat history.\");\r\n        }\r\n    };\r\n\r\n\r\n    // --- UI/STATE Handlers ---\r\n\r\n    // A. Starts a new chat session\r\n    const handleNewChat = () => {\r\n        const newId = uuidv4();\r\n        // Add a temporary entry to the list (backend will confirm title on first message)\r\n        setChatList(prev => [{ id: newId, title: 'New Chat' }, ...prev]);\r\n        setCurrentChatId(newId);\r\n        setMessages([]);\r\n        setError('');\r\n        setInput('');\r\n    };\r\n\r\n    // B. Logic to load chat list on mount\r\n    useEffect(() => {\r\n        if (sessionToken) {\r\n            fetchChatList();\r\n        }\r\n    }, [sessionToken, fetchChatList]);\r\n\r\n    // C. Logic to load messages when currentChatId changes\r\n    useEffect(() => {\r\n        if (currentChatId) {\r\n            fetchMessages(currentChatId);\r\n        }\r\n    }, [currentChatId, fetchMessages]);\r\n\r\n\r\n    // --- Core Chat Handlers (Modified to use currentChatId) ---\r\n\r\n    const handleSendMessage = async (e) => {\r\n        e.preventDefault();\r\n        const message = input.trim();\r\n        if (!message || isLoading || !currentChatId) return;\r\n\r\n        setIsLoading(true);\r\n        setInput('');\r\n        const userMessage = { sender: 'user', text: message, timestamp: new Date().toISOString() };\r\n        setMessages(prev => [...prev, userMessage]);\r\n\r\n        try {\r\n            const response = await fetch(`${API_BASE_URL}/api/chat`, {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': `Bearer ${sessionToken}`\r\n                },\r\n                body: JSON.stringify({ message, chat_id: currentChatId }), // SEND the unique chat_id\r\n            });\r\n\r\n            if (response.status === 401) { onSignOut(); return; }\r\n            \r\n            const data = await response.json();\r\n\r\n            if (!response.ok) {\r\n                throw new Error(data.error || 'Chat response failed.');\r\n            }\r\n            \r\n            const botMessage = { sender: 'bot', text: data.response, timestamp: new Date().toISOString() };\r\n            setMessages(prev => [...prev, botMessage]);\r\n\r\n            // If this was a new chat, update the title in the list\r\n            if (chatList.find(c => c.id === currentChatId)?.title === 'New Chat') {\r\n                setChatList(prev => prev.map(chat => \r\n                    chat.id === currentChatId ? { ...chat, title: data.chat_title || message.substring(0, 25) } : chat\r\n                ));\r\n            }\r\n\r\n        } catch (err) {\r\n            console.error(err);\r\n            setError(err.message);\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n    \r\n    // File upload must also be associated with the current chat ID\r\n    const handleFileUpload = async (file) => {\r\n        if (isLoading || !currentChatId) return;\r\n\r\n        setIsLoading(true);\r\n        setError('');\r\n\r\n        const formData = new FormData();\r\n        formData.append('file', file);\r\n        formData.append('chat_id', currentChatId); // SEND the unique chat_id\r\n\r\n        try {\r\n            const response = await fetch(`${API_BASE_URL}/upload`, {\r\n                method: 'POST',\r\n                headers: { 'Authorization': `Bearer ${sessionToken}` },\r\n                body: formData,\r\n            });\r\n\r\n            if (response.status === 401) { onSignOut(); return; }\r\n            \r\n            const data = await response.json();\r\n\r\n            if (!response.ok) {\r\n                throw new Error(data.error || 'File upload failed.');\r\n            }\r\n            \r\n            const botMessage = { sender: 'bot', text: data.message, timestamp: new Date().toISOString() };\r\n            setMessages(prev => [...prev, botMessage]);\r\n\r\n        } catch (err) {\r\n            console.error(err);\r\n            setError(err.message);\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    // Consolidate props for the view component\r\n    const viewProps = {\r\n        // State & Refs\r\n        user, messages, input, setInput, isLoading, error, chatEndRef, onSignOut,\r\n        \r\n        // Handlers\r\n        handleSendMessage, handleFileUpload,\r\n        \r\n        // NEW History Props\r\n        currentChatId, chatList, \r\n        setCurrentChatId, // This acts as onSelectChat\r\n        handleNewChat,\r\n        onDeleteChat: handleDeleteChat,\r\n    };\r\n\r\n\r\n    return (\r\n        <ChatPageView {...viewProps} />\r\n    );\r\n};\r\n\r\nexport default ChatPage;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}